<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>XML com ajax Catalogo de filmes</title>
  <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

<script src="xmltojson.js"></script>
<script>
  function getFilmes(){
    let xmlHttp = new XMLHttpRequest();
    //xmlHttp.open('GET','http://localhost/ajax/filmes.xml')
    xmlHttp.open('GET', 'https://deivid94.github.io/ajax/filmes.xml')
    
    xmlHttp.onreadystatechange = () =>{
      if(xmlHttp.readyState == 4 && xmlHttp.status == 200){
        let xmlFilmes = xmlHttp.responseText
        /*Vamos criar um objeto do arquivo xml 
        como ainda nao sabemos usar json vamos fazer
        manualmente */

        let parser = new DOMParser()
        domFilmes = parser.parseFromString(xmlFilmes,'text/xml')
        jsonFilmes = xmlToJson(domFilmes)
        //console.log(jsonFilmes)

        // percorrendo indice de filmes
        for (let i in jsonFilmes['filmes']['filme']){
          item = (jsonFilmes['filmes']['filme'][i])
          

          //criando as divs class row para os titulos
          let divRow = document.createElement('div')
          divRow.className = 'row'

          //criando divs class cool
          let divCol  = document.createElement('div')
          divCol.className = 'col'

            let p1 = document.createElement('p')
            p1.innerHTML = '<strong> Titulo:</strong>' + item['titulo']['#text']
            let p2 = document.createElement('p')
            p2.innerHTML = '<strong> Resumo:</strong>' + item['resumo']['#text']

            let genero = ''
            for( g in item.genero){
              if (genero) genero+= ', '
              genero += (item.genero[g]['#text'])
            }


            let p3 = document.createElement('p')
            p3.innerHTML = '<strong> genero:</strong>' +genero

              elenco = ''
              for(e in item.elenco.ator){
                if (elenco) elenco+=', '
                elenco+= (item.elenco.ator[e]['#text'])
              }

            let p4 = document.createElement('p')
            p4.innerHTML = '<strong> Elenco:</strong>' +elenco
            
            let p5 = document.createElement('p')
            p5.innerHTML = '<strong> Data de lancamento:</strong>' +item['dataLancamento']['#text'] 
          
            let hr = document.createElement('hr')

            divRow.appendChild(divCol)
            divCol.appendChild(p1)
            divCol.appendChild(p2)
            divCol.appendChild(p3)
            divCol.appendChild(p4)
            divCol.appendChild(p5)
            divCol.appendChild(hr)
            
            document.getElementById('lista').appendChild(divRow)

           }


      }
      if (xmlHttp.readyState == 4 && xmlHttp.status == 404){
        alert ('Nao funcionou')
      }
    }

    xmlHttp.send()
  }
</script>




</head>
<body>
  <nav class="navbar navbar-light bg-light mb-4">
    <div class="container">
      <div class="navbar-brand mb-0 h1">
        <h3>Catalogo de Filmes</h3>

      </div>
    </div>
  </nav>
  <div class="container" id ="lista">
    <div class="row mb-5">
      <div class="col">
        <button class="btn btn-success" type ="button" onclick="getFilmes()">Listas Filmes</button>
      </div>
    </div>
    
  </div>
</body>
</html>